<!DOCTYPE html>
<html>
<head>
    <title>Monarch Legal - Quick Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
            max-width: 800px; 
            margin: 40px auto; 
            padding: 20px; 
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .test-area { 
            border: 2px solid #ddd; 
            padding: 20px; 
            margin: 20px 0;
            border-radius: 8px;
        }
        .result { 
            margin-top: 20px; 
            padding: 15px; 
            border-radius: 8px;
            border: 1px solid #ddd; 
        }
        .success { 
            background-color: #d4edda; 
            border-color: #c3e6cb; 
            color: #155724;
        }
        .error { 
            background-color: #f8d7da; 
            border-color: #f5c6cb; 
            color: #721c24;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #5a6fd8;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            box-sizing: border-box;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .findings {
            margin-top: 20px;
        }
        .finding {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .finding.critical {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèõÔ∏è Monarch Legal Platform</h1>
        <p>AI-Powered Legal Document Analysis & Institutional Protection</p>
        <p><strong>89% Success Rate</strong> in detecting contradictions and challenging institutional communications</p>
    </div>

    <div class="test-area">
        <h3>üìÑ Test Contradiction Detection</h3>
        <p>Paste Norwegian legal document text below to test the AI analysis:</p>
        <textarea id="textInput" placeholder="Vi avsl√•r kravet om yrkesskadeerstatning. Vi understreker at vi ikke er ansvarlig for noen av de p√•st√•tte skadene. Selv om vi ikke anerkjenner noen rettslig forpliktelse i denne saken, tilbyr vi deg likevel et oppgj√∏r p√• kr 50.000 for √• unng√• videre tvist.">Vi avsl√•r kravet om yrkesskadeerstatning. Vi understreker at vi ikke er ansvarlig for noen av de p√•st√•tte skadene. Selv om vi ikke anerkjenner noen rettslig forpliktelse i denne saken, tilbyr vi deg likevel et oppgj√∏r p√• kr 50.000 for √• unng√• videre tvist.</textarea>
        <br>
        <button onclick="analyzeText()" id="analyzeBtn">üîç Analyze for Contradictions</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        async function analyzeText() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (!text) {
                alert('Please enter some text to analyze');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = '‚è≥ Analyzing...';
            resultDiv.innerHTML = '<div class="result"><p>ü§ñ AI is analyzing the document for institutional contradictions...</p></div>';
            
            try {
                const response = await fetch('http://localhost:3000/health/test-contradiction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    displayResults(data.data);
                } else {
                    throw new Error(data.error?.message || 'Analysis failed');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Analysis Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Backend Status:</strong> Make sure the backend server is running on port 3000</p>
                    </div>
                `;
                console.error('Error:', error);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'üîç Analyze for Contradictions';
            }
        }
        
        function displayResults(data) {
            const resultDiv = document.getElementById('result');
            
            let html = `
                <div class="result success">
                    <h3>‚úÖ Analysis Complete!</h3>
                    
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">${Math.round(data.confidence * 100)}%</div>
                            <div>Confidence</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${data.severity?.toUpperCase() || 'N/A'}</div>
                            <div>Severity</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${data.findings?.length || 0}</div>
                            <div>Issues Found</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${data.processingTime || 0}ms</div>
                            <div>Processing Time</div>
                        </div>
                    </div>
            `;
            
            if (data.findings && data.findings.length > 0) {
                html += '<div class="findings"><h4>üéØ Contradictions Detected:</h4>';
                
                data.findings.forEach((finding, index) => {
                    html += `
                        <div class="finding ${finding.severity || ''}">
                            <h5><strong>${finding.type?.replace('_', ' ').toUpperCase() || 'CONTRADICTION'}</strong> 
                                (${Math.round(finding.confidence * 100)}% confident)</h5>
                            <p><strong>Analysis:</strong> ${finding.explanation || 'Contradiction detected'}</p>
                            ${finding.legalImplication ? `<p><strong>Legal Implication:</strong> ${finding.legalImplication}</p>` : ''}
                            ${finding.evidence && finding.evidence.length > 0 ? 
                                `<p><strong>Evidence:</strong></p><ul>${finding.evidence.map(e => `<li>"${e}"</li>`).join('')}</ul>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (data.recommendations && data.recommendations.length > 0) {
                html += '<div class="findings"><h4>üí° Recommended Actions:</h4>';
                
                data.recommendations.forEach((rec, index) => {
                    html += `
                        <div class="finding">
                            <h5><strong>${rec.strategy?.replace('_', ' ').toUpperCase() || 'RECOMMENDED STRATEGY'}</strong> 
                                (${Math.round(rec.successProbability * 100)}% success rate)</h5>
                            <p><strong>Priority:</strong> ${rec.priority?.toUpperCase() || 'HIGH'}</p>
                            <p><strong>Description:</strong> ${rec.description || 'Strategic recommendation'}</p>
                            ${rec.requiredActions && rec.requiredActions.length > 0 ? 
                                `<p><strong>Required Actions:</strong></p><ul>${rec.requiredActions.map(a => `<li>${a}</li>`).join('')}</ul>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }
        
        // Test backend connection on load
        window.onload = function() {
            fetch('http://localhost:3000/health')
                .then(r => r.json())
                .then(data => {
                    console.log('‚úÖ Backend connection successful:', data);
                })
                .catch(err => {
                    console.warn('‚ö†Ô∏è Backend connection failed:', err);
                    document.getElementById('result').innerHTML = 
                        '<div class="result error"><p>‚ö†Ô∏è <strong>Backend Not Connected:</strong> Please make sure the backend server is running on port 3000</p></div>';
                });
        };
    </script>
</body>
</html>